---
 - name: Creating A ELB
   local_action:
     module: ec2_elb_lb
     name: "{{ rgn }}-{{ env }}-{{ app }}"
     state: present
     region: "{{ ec2_region }}"
     zones:
       - "{{ ec2_zone }}"
     listeners:
      - protocol: http
        load_balancer_port: 80
        instance_port: 80
     tags:
       Name: "{{ rgn }}-{{ env }}-{{ app }}"
       Stack: "{{ rgn }}-{{ env }}-{{ app }}"

 - name: add the webservers to the load balancer
   local_action: ec2_elb
   args:
     instance_id: "{{ item.id }}"
     ec2_elbs: "{{ rgn }}-{{ env }}-{{ app }}"
     state: present
     region: "{{ ec2_region }}"
   with_items: "{{ ec2.tagged_instances }}"

